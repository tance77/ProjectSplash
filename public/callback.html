<html>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    <title>Splash Bros - Streamlabs Authorize</title>
    <link rel="apple-touch-icon" sizes="180x180" href="./assets/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./assets/favicon/favicon-16x16.png">
    <link rel="manifest" href="./assets/favicon/site.webmanifest">
    <link rel="mask-icon" href="./assets/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
</head>
<body>

<div id="app">
</div>
</body>
</html>
<script>
  let app = new Vue({
    el: '#app',
    data () {
      return {
        code: null,
      }
    },
    methods: {

      stripAuthCode () {
        let queryString = window.location.search
        if (queryString === '' || queryString === null || queryString === undefined) {
          return null
        }
        let params = new URLSearchParams(queryString.substring(1))
        return params.get('code')
      },



      getStreamLabsToken () {
        return axios.post('http://localhost:3000/auth', {code: this.code}).then(resp=>{
          window.location.href='http://localhost:3000/'
        })
      }

    },
    mounted(){
      this.code = this.stripAuthCode()
      this.getStreamLabsToken()
    }
  })
</script>